<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <record id="email_template_tms_waybill" model="mail.template">
            <field name="name">TMS: Envio de Cotización</field>
            <field name="model_id" ref="tms.model_tms_waybill"/>
            <field name="subject">{{ object.company_id.name }} Cotización {{ object.name }}</field>
            <field name="partner_to">{{ object.partner_invoice_id.id }}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p>
                        Hola <t t-out="object.partner_invoice_id.name"/>,
                        <br/><br/>
                        Adjuntamos su cotización <strong><t t-out="object.name"/></strong>.
                        <br/>
                        <div style="text-align: center; margin: 16px 0;">
                            <!-- CORRECCIÓN: target="_blank" para abrir en nueva pestaña -->
                            <a t-att-href="object.get_portal_url()"
                               target="_blank"
                               class="tms_waybill_portal_link"
                               style="background-color: #875A7B; color: white; padding: 8px 16px; text-decoration: none; border-radius: 5px;">
                               Ver y Firmar Online
                            </a>
                        </div>
                    </p>
                </div>
            </field>
            <!-- REFERENCIA CRÍTICA: Debe coincidir con el ID del record en tms_waybill_report.xml -->
            <field name="report_template_ids" eval="[(4, ref('tms.action_report_tms_waybill'))]"/>
            <field name="lang">{{ object.partner_invoice_id.lang }}</field>
            <field name="auto_delete" eval="True"/>
        </record>
    </data>
</odoo>
