<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <record id="email_template_tms_waybill" model="mail.template">
            <field name="name">TMS: Envio de Cotización</field>
            <field name="model_id" ref="tms.model_tms_waybill"/>
            <field name="subject">{{ object.company_id.name }} Cotización {{ object.name }}</field>
            <field name="email_from">{{ (object.create_uid.email_formatted or user.email_formatted) }}</field>
            <field name="partner_to">{{ object.partner_invoice_id.id }}</field>

            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p>
                        Hola <t t-out="object.partner_invoice_id.name"/>,
                        <br/><br/>
                        Adjuntamos la cotización <strong><t t-out="object.name"/></strong>.
                        <br/>
                        Puede revisarla y firmarla en línea haciendo clic en el siguiente botón:
                        <br/><br/>
                        <!-- ENLACE AL PORTAL -->
                        <!-- get_portal_url() genera el link con token de acceso seguro -->
                        <a t-att-href="object.get_portal_url()"
                           style="padding: 10px 20px; background-color: #875A7B; color: #FFFFFF; text-decoration: none; border-radius: 5px; font-weight: bold;">
                            Revisar y Firmar
                        </a>
                        <br/><br/>
                        Gracias por su confianza.
                    </p>
                </div>
            </field>

            <!-- REF AL REPORTE PDF -->
            <!-- Asegúrate de que reports/tms_waybill_report.xml esté cargado ANTES en el manifiesto -->
            <field name="report_template_ids" eval="[(4, ref('tms.action_report_tms_waybill'))]"/>

            <field name="lang">{{ object.partner_invoice_id.lang }}</field>
            <field name="auto_delete" eval="True"/>
        </record>
    </data>
</odoo>
